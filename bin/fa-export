#! /usr/bin/env ruby
#
# @abstract Poor Man's version of a FlightAware client
#
# @author Ollivier Robert <ollivier.robert@eurocontrol.int>
# @copyright 2015 by Ollivier Robert for ECTL
#

# Usual housekeeping variables
BASEDIR = File.dirname(File.expand_path($0))
$LOAD_PATH << File.join(BASEDIR, '..', 'lib')

# Standard modules
require 'openssl'
require 'yaml'

# External modules
require 'celluloid/io'

# Setup things
require 'flightaware/client'
require 'config'

# Default config file
DEF_CONFIG = File.join(ENV['HOME'], '.flightaware', 'config.yml')

trap(:INT) { puts("INT: stopping..."); exit(0) }
trap(:TERM) { puts("TERM: stopping..."); exit(0) }

def main(argv)
  config = MyConfig.load

  fa = FlightAware::Client.new(config)
  loop { fa.run }
end

if __FILE__ == $0
  exit(main(ARGV) || 1)
end
